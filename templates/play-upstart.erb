# Upstart script for Play 2.0 application <%= name %>.
#
# Based on work by https://gist.github.com/2204773
#
# Usage:
#   start play
#   stop play
#   restart play
#

description "<%= name %>"
author "Andre Dumas"
version "1.0"

env USER=<%= user %>
env GROUP=<%= group %>
env APP_HOME=<%= path %>
env PLAY_HOME=<%= play_home %>
env PORT=9000
env ADDRESS=127.0.0.1
env EXTRA="-Xms128M -Xmx512m -server"

#start on (filesystem and net-device-up IFACE=lo) or runlevel [2345]
#stop on runlevel [!2345]
start on runlevel [2345]
# Is this correct?
stop on runlevel [06]

respawn
respawn limit 10 5
umask 022
expect daemon

pre-start script
    chdir $APP_HOME
    rm RUNNING_PID || true
    ${PLAY_HOME}/play clean compile stage
end script

exec start-stop-daemon --pidfile ${APP_HOME}/RUNNING_PID --chuid $USER:$GROUP --exec ${APP_HOME}/target/start --background --start -- -Dhttp.port=$PORT -Dhttp.address=$ADDRESS $EXTRA
